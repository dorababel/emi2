<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Values Selector</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
    .card { border: 1px solid #ccc; padding: 10px; cursor: pointer; border-radius: 4px; transition: background 0.2s; }
    .card.selected { background: #cce5ff; border-color: #66b0ff; }
    .btn { padding: 8px 16px; margin: 10px 0; font-size: 16px; border: none; border-radius: 4px; cursor: pointer; }
    .btn:disabled { background: #ddd; cursor: not-allowed; }
    .area { display: flex; gap: 20px; margin-top: 20px; }
    .zone, .pool, .slots { flex: 1; border: 2px dashed #aaa; min-height: 200px; padding: 10px; border-radius: 4px; }
    .zone { position: relative; }
    .zone-title, .pool-title, .slots-title { position: absolute; top: -20px; left: 10px; background: #fff; padding: 0 4px; font-weight: bold; }
    .small-card { border: 1px solid #666; padding: 4px 6px; margin: 4px; border-radius: 4px; cursor: move; display: inline-block; background: #f8f9fa; }
    .slot { border: 1px solid #888; padding: 10px; margin: 8px 0; min-height: 40px; border-radius: 4px; }
    .slot-number { font-weight: bold; margin-right: 8px; }
    canvas { border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>

<!-- Step 1 -->
<div id="step1">
  <h2>Select 10–15 Values</h2>
  <div id="valuesGrid" class="grid"></div>
  <button id="toStep2Btn" class="btn" disabled>Next</button>
</div>

<!-- Step 2 -->
<div id="step2" class="hidden">
  <h2>Sort Into Top 1–5 and Top 6–10</h2>
  <div class="pool zone" id="pool2"><div class="pool-title">Pool</div></div>
  <div class="area">
    <div class="zone" id="zone1"><div class="zone-title">TOP 1–5</div></div>
    <div class="zone" id="zone2"><div class="zone-title">TOP 6–10</div></div>
  </div>
  <button id="backToStep1Btn" class="btn">Back</button>
  <button id="toStep3Btn" class="btn" disabled>Next</button>
</div>

<!-- Step 3 -->
<div id="step3" class="hidden">
  <h2>Rank Your Top 5</h2>
  <div class="slots" id="slots3"><div class="slots-title">Slots</div></div>
  <div class="pool zone" id="pool3"><div class="pool-title">Pool</div></div>
  <button id="startOverBtn" class="btn">Start Over</button>
  <button id="finalizeBtn" class="btn" disabled>Finalize</button>
</div>

<!-- Canvas & Download -->
<canvas id="resultCanvas" width="600" height="400" class="hidden"></canvas>
<button id="downloadBtn" class="btn hidden">Download Image</button>

<script>
  const values = [
    { title: 'HONESTY', definition: 'Being truthful and transparent.' },
    { title: 'COMPASSION', definition: 'Showing empathy and care.' },
    { title: 'CREATIVITY', definition: 'Thinking outside the box.' },
    { title: 'GROWTH', definition: 'Continuously improving.' },
    { title: 'COURAGE', definition: 'Facing fears boldly.' },
    { title: 'BALANCE', definition: 'Maintaining harmony.' },
    { title: 'RESPECT', definition: 'Valuing others.' },
    { title: 'RESPONSIBILITY', definition: 'Owning your actions.' },
    { title: 'FREEDOM', definition: 'Being independent.' },
    { title: 'LOVE', definition: 'Showing deep affection.' },
    { title: 'JOY', definition: 'Experiencing happiness.' },
    { title: 'SECURITY', definition: 'Feeling safe.' },
    { title: 'LEARNING', definition: 'Acquiring knowledge.' },
    { title: 'HEALTH', definition: 'Caring for body and mind.' },
    { title: 'COMMUNITY', definition: 'Belonging with others.' },
    { title: 'INNOVATION', definition: 'Introducing new ideas.' },
    { title: 'TRUST', definition: 'Building confidence.' },
    { title: 'GRATITUDE', definition: 'Appreciating what you have.' },
    { title: 'ADVENTURE', definition: 'Seeking excitement.' },
    { title: 'WISDOM', definition: 'Applying knowledge.' }
  ];

  let selected = [];
  let top1 = [];
  let top2 = [];
  let finalRank = {};

  // Render Step 1
  const grid = document.getElementById('valuesGrid');
  values.forEach((v, i) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.index = i;
    card.innerHTML = `<strong>${v.title}</strong><p>${v.definition}</p>`;
    card.addEventListener('click', () => {
      const idx = selected.indexOf(i);
      if (idx === -1 && selected.length < 15) {
        selected.push(i);
        card.classList.add('selected');
      } else if (idx > -1) {
        selected.splice(idx,1);
        card.classList.remove('selected');
      }
      document.getElementById('toStep2Btn').disabled = !(selected.length >= 10 && selected.length <= 15);
    });
    grid.appendChild(card);
  });

  document.getElementById('toStep2Btn').addEventListener('click', () => {
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.remove('hidden');
    setupStep2();
  });

  document.getElementById('backToStep1Btn').addEventListener('click', () => {
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step1').classList.remove('hidden');
  });

  function setupStep2() {
    const pool = document.getElementById('pool2');
    pool.querySelectorAll('.small-card').forEach(n=>n.remove());
    top1 = [];
    top2 = [];
    document.getElementById('toStep3Btn').disabled = true;
    selected.forEach(i => {
      const card = makeSmallCard(i);
      pool.appendChild(card);
    });
    ['zone1','zone2'].forEach(z => {
      const zone = document.getElementById(z);
      zone.querySelectorAll('.small-card').forEach(n=>n.remove());
      zone.ondragover = e => e.preventDefault();
      zone.ondrop = e => handleDrop(e, z);
    });
  }

  function makeSmallCard(i) {
    const card = document.createElement('div');
    card.className = 'small-card';
    card.draggable = true;
    card.dataset.index = i;
    card.textContent = values[i].title;
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', i);
    });
    card.addEventListener('click', () => {
      // return to pool
      const parent = card.parentElement.id;
      if (parent === 'zone1') top1 = top1.filter(x=>x!==i);
      if (parent === 'zone2') top2 = top2.filter(x=>x!==i);
      document.getElementById('pool2').appendChild(card);
      updateStep2Next();
    });
    return card;
  }

  function handleDrop(e, zoneId) {
    const i = parseInt(e.dataTransfer.getData('text/plain'));
    const zone = document.getElementById(zoneId);
    const arr = zoneId==='zone1'? top1: top2;
    if (arr.length >= 5) { alert('Only 5 cards allowed here'); return; }
    // remove from other if exists
    top1 = top1.filter(x=>x!==i);
    top2 = top2.filter(x=>x!==i);
    arr.push(i);
    const card = makeSmallCard(i);
    zone.appendChild(card);
    updateStep2Next();
  }

  function updateStep2Next() {
    document.getElementById('toStep3Btn').disabled = !(top1.length ===5 && top2.length ===5);
  }

  document.getElementById('toStep3Btn').addEventListener('click', () => {
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step3').classList.remove('hidden');
    setupStep3();
  });

  document.getElementById('startOverBtn').addEventListener('click', () => {
    location.reload();
  });

  function setupStep3() {
    finalRank = {};
    const pool = document.getElementById('pool3');
    const slotsContainer = document.getElementById('slots3');
    pool.querySelectorAll('.small-card').forEach(n=>n.remove());
    slotsContainer.querySelectorAll('.slot').forEach(n=>n.remove());
    top1.forEach(i => {
      const card = makeSmallCard(i);
      pool.appendChild(card);
    });
    for (let n=1; n<=5; n++) {
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.dataset.slot = n;
      slot.innerHTML = `<span class="slot-number">${n}.</span>`;
      slot.ondragover = e => e.preventDefault();
      slot.ondrop = e => {
        const i = parseInt(e.dataTransfer.getData('text/plain'));
        if (Object.values(finalRank).includes(i)) return;
        finalRank['s'+n] = i;
        const card = makeSmallCard(i);
        slot.appendChild(card);
        updateFinalize();
      };
      slotsContainer.appendChild(slot);
    }
    updateFinalize();
  }

  function updateFinalize() {
    document.getElementById('finalizeBtn').disabled = Object.keys(finalRank).length !==5;
  }

  document.getElementById('finalizeBtn').addEventListener('click', () => {
    document.getElementById('step3').classList.add('hidden');
    drawResult();
  });

  function drawResult() {
    const canvas = document.getElementById('resultCanvas');
    const ctx = canvas.getContext('2d');
    canvas.classList.remove('hidden');
    ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#000'; ctx.font = '24px Arial';
    ctx.fillText('My Top Five Values', 20, 40);
    ctx.font = '18px Arial';
    let y = 80;
    Object.keys(finalRank).sort().forEach((key, idx) => {
      const val = values[finalRank[key]].title;
      ctx.fillText(`${idx+1}. ${val}`, 20, y);
      y += 30;
    });
    document.getElementById('downloadBtn').classList.remove('hidden');
    document.getElementById('downloadBtn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'my-top-five-values.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Values Selection App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); grid-gap: 10px; }
    .card { border: 1px solid #ccc; padding: 10px; border-radius: 4px; cursor: pointer; background: #f9f9f9; }
    .card.selected { background: #d0eaff; border-color: #007bff; }
    .hidden { display: none; }
    .pool, .dropzone { border: 1px dashed #ccc; min-height: 100px; padding: 10px; }
    .dropzone { border: 2px dashed #aaa; }
    .dropzone.over { border-color: #007bff; }
    .slot { border: 1px dashed #aaa; padding: 10px; min-height: 40px; margin-bottom: 5px; }
    .slot.over { border-color: #007bff; }
    .button { padding: 10px 20px; margin: 5px; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
  </style>
</head>
<body>
  <div id="step1">
    <h2>Step 1 – Select 10–15 Values</h2>
    <div class="grid" id="valuesGrid"></div>
    <button id="next1" class="button" disabled>Next</button>
  </div>

  <div id="step2" class="hidden">
    <h2>Step 2 – Sort Into Top 1–5 and Top 6–10</h2>
    <div>
      <h3>Pool</h3>
      <div class="pool" id="pool"></div>
    </div>
    <div style="display:flex; gap:10px;">
      <div style="flex:1;">
        <h3>TOP 1–5</h3>
        <div class="dropzone" id="zone1"></div>
      </div>
      <div style="flex:1;">
        <h3>TOP 6–10</h3>
        <div class="dropzone" id="zone2"></div>
      </div>
    </div>
    <button id="back2" class="button">Back</button>
    <button id="next2" class="button" disabled>Next</button>
  </div>

  <div id="step3" class="hidden">
    <h2>Step 3 – Rank Your Top 5</n2>
    <div>
      <h3>Slots</h3>
      <div id="slots"></div>
    </div>
    <div>
      <h3>Pool</h3>
      <div class="pool" id="pool3"></div>
    </div>
    <button id="startOver" class="button">Start Over</button>
    <button id="finalize" class="button" disabled>Finalize</button>
    <canvas id="resultCanvas" class="hidden"></canvas>
    <a id="downloadLink" class="button hidden">Download Image</a>
  </div>

  <script>
    const values = [
      {title:'AUTHENTICITY',definition:'Being true to oneself'},
      {title:'COMPASSION',definition:'Showing empathy and kindness'},
      {title:'COURAGE',definition:'Doing what is right despite fear'},
      {title:'CREATIVITY',definition:'Thinking outside the box'},
      {title:'INTEGRITY',definition:'Honesty and strong moral principles'},
      {title:'RESPECT',definition:'Valuing others'},
      {title:'GROWTH',definition:'Continuous self-improvement'},
      {title:'BALANCE',definition:'Maintaining equilibrium'},
      {title:'JOY',definition:'Finding happiness in life'},
      {title:'FREEDOM',definition:'Ability to act independently'},
      {title:'GRATITUDE',definition:'Appreciation and thankfulness'},
      {title:'HONOR',definition:'High respect and esteem'},
      {title:'LEADERSHIP',definition:'Guiding others'},
      {title:'PEACE',definition:'Calm and tranquility'},
      {title:'SERVICE',definition:'Helping others'},
      {title:'WISDOM',definition:'Applying knowledge thoughtfully'},
      {title:'TRUST',definition:'Reliance on integrity'},
      {title:'PASSION',definition:'Strong enthusiasm'},
      {title:'STABILITY',definition:'Consistency and support'},
      {title:'ADVENTURE',definition:'Seeking new experiences'}
    ];

    let selectedValues = [], top1to5 = [], top6to10 = [], ranked = {};

    function renderStep1() {
      const grid = document.getElementById('valuesGrid');
      values.forEach((v,i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.index = i;
        card.innerHTML = `<strong>${v.title}</strong><p>${v.definition}</p>`;
        card.addEventListener('click', () => {
          const idx = selectedValues.indexOf(i);
          if (idx > -1) selectedValues.splice(idx,1);
          else if (selectedValues.length < 15) selectedValues.push(i);
          card.classList.toggle('selected');
          document.getElementById('next1').disabled = !(selectedValues.length>=10 & selectedValues.length<=15);
        });
        grid.appendChild(card);
      });
    }

    function toStep2() {
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      const pool = document.getElementById('pool');
      selectedValues.forEach(i => pool.appendChild(createPoolCard(i)));
    }

    function createPoolCard(index) {
      const v = values[index];
      const card = document.createElement('div');
      card.className = 'card pool-card';
      card.draggable = true;
      card.dataset.index = index;
      card.textContent = v.title;
      card.addEventListener('dragstart', onDragStart);
      card.addEventListener('click', () => removeFromZones(index));
      return card;
    }

    function onDragStart(e) {
      e.dataTransfer.setData('text/plain', e.target.dataset.index);
    }

    function setupDropzones() {
      ['zone1','zone2'].forEach((id,zoneIdx) => {
        const dz = document.getElementById(id);
        dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('over'); });
        dz.addEventListener('dragleave', e => { dz.classList.remove('over'); });
        dz.addEventListener('drop', e => {
          e.preventDefault(); dz.classList.remove('over');
          const idx = parseInt(e.dataTransfer.getData('text/plain'));
          const list = zoneIdx===0 ? top1to5 : top6to10;
          if (list.length >=5) { alert('Zone full'); return; }
          removeFromZones(idx);
          list.push(idx);
          renderZones();
          document.getElementById('next2').disabled = !(top1to5.length===5 && top6to10.length===5);
        });
      });
    }

    function removeFromZones(index) {
      [top1to5,top6to10].forEach(list => {
        const idx = list.indexOf(index);
        if (idx > -1) list.splice(idx,1);
      });
      renderZones();
    }

    function renderZones() {
      ['zone1','zone2'].forEach((id,zoneIdx) => {
        const dz = document.getElementById(id);
        dz.innerHTML = '';
        const list = zoneIdx===0 ? top1to5 : top6to10;
        list.forEach(i => {
          const el = document.createElement('div');
          el.className = 'card';
          el.textContent = values[i].title;
          el.addEventListener('click', () => removeFromZones(i));
          dz.appendChild(el);
        });
      });
      const pool = document.getElementById('pool');
      pool.innerHTML = '';
      selectedValues.forEach(i => {
        if (!top1to5.includes(i) && !top6to10.includes(i)) pool.appendChild(createPoolCard(i));
      });
    }

    function toStep3() {
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.remove('hidden');
      const pool3 = document.getElementById('pool3');
      top1to5.forEach(i => pool3.appendChild(createPoolCard(i)));
      const slotsDiv = document.getElementById('slots');
      for (let n=1; n<=5; n++) {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.dataset.slot = n;
        slot.textContent = 'Slot ' + n;
        slot.addEventListener('dragover', e => { e.preventDefault(); slot.classList.add('over'); });
        slot.addEventListener('dragleave', e => { slot.classList.remove('over'); });
        slot.addEventListener('drop', e => {
          e.preventDefault(); slot.classList.remove('over');
          const idx = parseInt(e.dataTransfer.getData('text/plain'));
          if (ranked[n]) return;
          const el = document.querySelector('#pool3 .pool-card[data-index="'+idx+'"]');
          if (el) el.remove();
          ranked[n] = idx;
          const card = document.createElement('div');
          card.className = 'card';
          card.textContent = values[idx].title;
          card.addEventListener('click', () => {
            delete ranked[n];
            card.remove();
            pool3.appendChild(createPoolCard(idx));
            checkFinalize();
          });
          slot.appendChild(card);
          checkFinalize();
        });
        slotsDiv.appendChild(slot);
      }
    }

    function checkFinalize() {
      document.getElementById('finalize').disabled = (Object.keys(ranked).length !== 5);
    }

    function finalize() {
      const canvas = document.getElementById('resultCanvas');
      const ctx = canvas.getContext('2d');
      const width = 600, height = 400;
      canvas.width = width; canvas.height = height;
      ctx.fillStyle = 'white'; ctx.fillRect(0,0,width,height);
      ctx.fillStyle = 'black'; ctx.font = '24px Arial'; ctx.fillText('My Top Five Values',20,40);
      ctx.font = '20px Arial'; let y=80;
      [1,2,3,4,5].forEach(n => {
        const idx = ranked[n];
        ctx.fillText(n+'. '+values[idx].title, 20, y);
        y += 30;
      });
      canvas.classList.remove('hidden');
      const link = document.getElementById('downloadLink');
      link.href = canvas.toDataURL('image/png');
      link.download = 'my_top_five_values.png';
      link.classList.remove('hidden');
    }

    document.getElementById('next1').addEventListener('click', toStep2);
    document.getElementById('back2').addEventListener('click', () => {
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
    });
    document.getElementById('next2').addEventListener('click', toStep3);
    document.getElementById('startOver').addEventListener('click', () => location.reload());
    document.getElementById('finalize').addEventListener('click', finalize);

    renderStep1();
    setupDropzones();
  </script>
</body>
</html>

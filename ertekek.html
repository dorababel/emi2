<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Values Selector</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none; }
    .grid { display: flex; flex-wrap: wrap; margin: -5px; }
    .card {
      box-sizing: border-box;
      width: 120px; height: 80px;
      margin: 5px;
      padding: 5px;
      border: 1px solid #ccc;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      user-select: none;
    }
    .card.selected {
      border-color: #007BFF;
      background-color: #E0F0FF;
    }
    button { margin-top: 10px; padding: 8px 16px; }
    .pool, .zones, .slots { margin-top: 20px; }
    .pool-card {
      display: inline-block;
      padding: 5px 10px;
      margin: 5px;
      border: 1px solid #ccc;
      cursor: move;
      user-select: none;
      text-align: center;
      text-transform: uppercase;
    }
    .zones { display: flex; gap: 20px; }
    .zone {
      flex: 1;
      min-height: 120px;
      border: 2px dashed #ccc;
      padding: 10px;
    }
    .zone.over { border-color: #007BFF; }
    .zone .pool-card { display: block; margin: 5px 0; }
    .slots { display: flex; gap: 10px; }
    .slot {
      flex: 1;
      height: 60px;
      border: 2px dashed #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
    }
    #canvasContainer { margin-top: 20px; text-align: center; }
  </style>
</head>
<body>
  <!-- Step 1 -->
  <div id="step1">
    <label>Your Name: <input type="text" id="userName"></label>
    <div class="grid" id="valuesGrid"></div>
    <button id="toStep2" disabled>Next</button>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="hidden">
    <button id="backTo1">Return</button>
    <div class="pool" id="step2Pool"></div>
    <div class="zones">
      <div class="zone" id="zone1"><strong>TOP 1–5</strong></div>
      <div class="zone" id="zone2"><strong>TOP 6–10</strong></div>
    </div>
    <button id="toStep3" disabled>Next</button>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="hidden">
    <button id="backTo2">Return</button>
    <button id="startOver">Start Over</button>
    <div class="pool" id="step3Pool"></div>
    <div class="slots" id="slotsContainer"></div>
    <button id="finalize" disabled>Finalize</button>
  </div>

  <!-- Canvas Output -->
  <div id="canvasContainer" class="hidden">
    <canvas id="resultCanvas" width="600" height="400"></canvas><br>
    <button id="download">Download</button>
  </div>

  <script>
    const valuesList = [
      { title: 'AUTHENTICITY', def: 'Being true to yourself' },
      { title: 'BALANCE', def: 'Maintaining harmony in life' },
      { title: 'COURAGE', def: 'Facing fears boldly' },
      { title: 'CREATIVITY', def: 'Thinking outside the box' },
      { title: 'COMPASSION', def: 'Showing empathy to others' },
      { title: 'GROWTH', def: 'Continual self-improvement' },
      { title: 'INTEGRITY', def: 'Acting with honesty' },
      { title: 'JOY', def: 'Finding happiness daily' },
      { title: 'RESILIENCE', def: 'Bouncing back from setbacks' },
      { title: 'PEACE', def: 'Inner calm and tranquility' },
      { title: 'DISCIPLINE', def: 'Consistent self-control' },
      { title: 'ADVENTURE', def: 'Embracing new experiences' },
      { title: 'FREEDOM', def: 'Living without constraints' },
      { title: 'LEARNING', def: 'Seeking knowledge' },
      { title: 'SERVICE', def: 'Helping others selflessly' }
    ];

    // Step 1
    const grid = document.getElementById('valuesGrid');
    const toStep2Btn = document.getElementById('toStep2');
    let selected = new Set();
    valuesList.forEach((v,i) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<strong>${v.title}</strong><small>${v.def}</small>`;
      card.addEventListener('click', () => {
        if (card.classList.contains('selected')) {
          card.classList.remove('selected'); selected.delete(i);
        } else {
          if (selected.size >= 15) { alert('Max 15'); return; }
          card.classList.add('selected'); selected.add(i);
        }
        toStep2Btn.disabled = !(selected.size >= 10 && selected.size <= 15);
      });
      grid.appendChild(card);
    });
    toStep2Btn.addEventListener('click', () => {
      const pool = document.getElementById('step2Pool'); pool.innerHTML = '';
      selected.forEach(i => createPoolCard(i, pool));
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
    });

    document.getElementById('backTo1').addEventListener('click', () => {
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
    });

    // Drag & Drop Helpers
    function createPoolCard(i, container) {
      const c = document.createElement('div');
      c.className = 'pool-card'; c.draggable = true;
      c.textContent = valuesList[i].title;
      c.dataset.index = i;
      c.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', i));
      container.appendChild(c);
    }
    function setupZone(zoneId, max, onChange) {
      const zone = document.getElementById(zoneId);
      zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
      zone.addEventListener('dragleave', () => zone.classList.remove('over'));
      zone.addEventListener('drop', e => {
        e.preventDefault(); zone.classList.remove('over');
        const i = e.dataTransfer.getData('text/plain');
        if (zone.querySelectorAll('.pool-card').length >= max) { alert('Limit '+max); return; }
        const card = document.querySelector(`.pool-card[data-index='${i}']`);
        zone.appendChild(card);
        onChange();
      });
    }

    // Step 2 Zones
    setupZone('zone1', 5, checkStep2);
    setupZone('zone2', 5, checkStep2);
    function checkStep2() {
      const z1 = document.getElementById('zone1').querySelectorAll('.pool-card').length;
      const z2 = document.getElementById('zone2').querySelectorAll('.pool-card').length;
      document.getElementById('toStep3').disabled = !(z1===5 && z2===5);
    }
    document.getElementById('toStep3').addEventListener('click', () => {
      const pool3 = document.getElementById('step3Pool'); pool3.innerHTML = '';
      document.querySelectorAll('#zone1 .pool-card').forEach(c=> pool3.appendChild(c));
      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.remove('hidden');
      setupStep3();
    });

    document.getElementById('backTo2').addEventListener('click', () => {
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
    });
    document.getElementById('startOver').addEventListener('click', () => location.reload());

    // Step 3
    function setupStep3() {
      const slots = document.getElementById('slotsContainer'); slots.innerHTML = '';
      for (let n=1; n<=5; n++) {
        const slot = document.createElement('div'); slot.className = 'slot'; slot.dataset.slot=n;
        slot.textContent = n;
        slot.addEventListener('dragover', e => { e.preventDefault(); });
        slot.addEventListener('drop', e => {
          e.preventDefault();
          const i = e.dataTransfer.getData('text/plain');
          if (slot.querySelector('.pool-card')) return;
          const card = document.querySelector(`.pool-card[data-index='${i}']`);
          slot.innerHTML=''; slot.appendChild(card);
          checkFinalize();
        });
        slots.appendChild(slot);
      }
      document.querySelectorAll('#step3Pool .pool-card').forEach(c=>{
        c.addEventListener('click', () => {
          // return from slot
          const parent = c.parentElement;
          if (parent.classList.contains('slot')) {
            document.getElementById('step3Pool').appendChild(c);
            parent.textContent = parent.dataset.slot;
            checkFinalize();
          }
        });
      });
    }
    function checkFinalize() {
      const filled = document.querySelectorAll('.slot .pool-card').length;
      document.getElementById('finalize').disabled = (filled!==5);
    }
    document.getElementById('finalize').addEventListener('click', () => {
      const name = document.getElementById('userName').value.trim();
      const top5 = Array.from(document.querySelectorAll('.slot .pool-card'))
        .sort((a,b)=> a.parentElement.dataset.slot - b.parentElement.dataset.slot)
        .map(c=>c.textContent);
      const canvas = document.getElementById('resultCanvas');
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#fff'; ctx.fillRect(0,0,canvas.width, canvas.height);
      ctx.fillStyle = '#000'; ctx.font='20px Arial';
      ctx.fillText(`${name} - Top Five Values`, 20, 40);
      ctx.font='16px Arial';
      top5.forEach((v,i) => ctx.fillText(`${i+1}. ${v}`, 20, 80 + i*30));
      document.getElementById('step3').classList.add('hidden');
      document.getElementById('canvasContainer').classList.remove('hidden');
    });

    document.getElementById('download').addEventListener('click', () => {
      const canvas = document.getElementById('resultCanvas');
      const link = document.createElement('a');
      link.download = 'top5-values.png'; link.href = canvas.toDataURL();
      link.click();
    });
  </script>
</body>
</html>

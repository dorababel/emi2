<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Értékfeltérképezés</title>
  <!-- === Load Poppins from Google Fonts === -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --dark-teal:  #0A484A;
      --mint-green: #83BCAC;
      --gray-bg:    #E9EDF4;
      --text-white: #FFFFFF;
      --text-dark:  #222222;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: var(--gray-bg); color: var(--text-dark); }
    .container { width: min(90%, 900px); margin: 0 auto; padding: 2rem 0; }
    header { background: var(--dark-teal); color: var(--text-white); }
    .header-inner { display: flex; align-items: center; justify-content: center; padding: 1rem 2rem; }
    .header-inner h1 { font-size: 1.5rem; font-weight: 600; }
    h1, h2 { font-weight: 700; margin-bottom: 1rem; }
    .btn {
      padding: 0.75rem 1.5rem;
      background: var(--mint-green);
      color: var(--text-white);
      border: none;
      border-radius: 50px;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s;
    }
    .btn:enabled { opacity: 1; }
    .values-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .card {
      background: var(--text-white);
      border-radius: 8px;
      padding: 1rem;
      height: 150px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      border: 2px solid transparent;
      overflow-wrap: break-word;
    }
    .card.selected { border-color: var(--mint-green); }
    .card-title { font-weight: 700; text-transform: uppercase; font-size: 0.9rem; }
    .card-def { font-weight: 300; font-size: 0.8rem; }
    #step2, #result { display: none; }
    #compareArea { display: flex; gap: 1rem; justify-content: center; margin: 2rem 0; }
    #compareArea .card { height: auto; flex: 1; }
    #resultList { background: var(--text-white); padding: 1rem; border-radius: 8px; }
    #resultList ol { padding-left: 1.5rem; }
  </style>
</head>
<body>
  <header>
    <div class="header-inner container">
      <h1>Motiva - Mind & Motion Lab</h1>
    </div>
  </header>
  <div class="container">
    <section id="step1">
      <h1>Személyes Értékek Feltérképezése</h1>
      <p>Válassz ki 10-15 értéket a listából, ami számodra különösen fontos!</p>
      <div class="values-grid" id="valuesGrid"></div>
      <button id="nextBtn" class="btn" disabled>Tovább</button>
    </section>

    <section id="step2">
      <h2>Melyik értéket részesíted előnyben?</h2>
      <div id="compareArea"></div>
      <button id="restartBtn" class="btn">újrakezdés</button>
    </section>

    <section id="result">
      <h2>Az 5 legfőbb értékem</h2>
      <div id="resultList"></div>
      <button id="downloadBtn" class="btn">Letöltés</button>
    </section>
  </div>

  <!-- html2canvas for image export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const values = [
      { name: 'SZABADSÁG', def: 'Saját döntések és cselekedetek függetlensége.' },
      { name: 'ŐSZINTESÉG', def: 'Nyílt és igaz kommunikáció.' },
      { name: 'BIZTONSÁG', def: 'Stabilitás és kiszámíthatóság érzése.' },
      { name: 'FELELŐSSÉG', def: 'Kötelességek vállalása és beteljesítése.' },
      { name: 'TISZTELET', def: 'Mások és önmagam megbecsülése.' },
      { name: 'EGYENSÚLY', def: 'Munka és magánélet harmonikus aránya.' },
      { name: 'KREATIVITÁS', def: 'Új ötletek és megoldások keresése.' },
      { name: 'EGÉSZSÉG', def: 'Fizikai és mentális jóllét fenntartása.' },
      { name: 'NÖVEKEDÉS', def: 'Személyes és szakmai fejlődés.' },
      { name: 'KÖZÖSSÉG', def: 'Kapcsolatok és társas támogatás.' },
      { name: 'SZERETET', def: 'Önzetlen törődés másokkal.' },
      { name: 'HÁLÁ', def: 'Elismerés és köszönet érzése.' },
      { name: 'BOLDOGSÁG', def: 'Pozitív érzelmek és öröm megélése.' },
      { name: 'FEJLŐDÉS', def: 'Folyamatos tanulás és kihívások vállalása.' },
      { name: 'INTEGRITÁS', def: 'Erkölcsi elvek tiszteletben tartása.' },
      { name: 'BÁTORSÁG', def: 'Félelem leküzdése és kockázatvállalás.' },
      { name: 'ÍTÉLETKÉSZ', def: 'Megfontolt döntéshozatal.' },
      { name: 'FELELŐSSÉG', def: 'Cselekedeteim következményeinek vállalása.' },
      { name: 'NYITOTTSÁG', def: 'Új tapasztalatok és nézőpontok befogadása.' },
      { name: 'ÉRTÉKELÉS', def: 'Mások teljesítményének elismerése.' },
      { name: 'BIZALOM', def: 'Megbízhatóság és hitelesség.' },
      { name: 'EGYEDISÉG', def: 'Sajátosságok és különlegességek elismerése.' },
      { name: 'HARMÓNIA', def: 'Belső és külső egyensúly.' },
      { name: 'FÜGGETLENSÉG', def: 'Önálló döntések és cselekvések.' },
      { name: 'RUGALMASSÁG', def: 'Alkalmazkodás a változásokhoz.' },
      { name: 'KÖNNYEDSÉG', def: 'Stresszmentes, laza életvitel.' },
      { name: 'TUDATOSSÁG', def: 'Cselekedeteim és gondolataim figyelemmel követése.' },
      { name: 'JÓVÁTEVÉS', def: 'Mások segítése és támogatása.' },
      { name: 'SZABADSÁG', def: 'Korlátozások nélküli cselekvés.' },
      { name: 'BELSŐ BÉKE', def: 'Nyugodt és kiegyensúlyozott állapot.' }
    ];
    let selected = [];
    const grid = document.getElementById('valuesGrid');
    const nextBtn = document.getElementById('nextBtn');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const compareArea = document.getElementById('compareArea');
    const restartBtn = document.getElementById('restartBtn');
    const resultSec = document.getElementById('result');
    const resultList = document.getElementById('resultList');
    const downloadBtn = document.getElementById('downloadBtn');

    // Render cards
    values.forEach((v, i) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<div class="card-title">${v.name}</div><div class="card-def">${v.def}</div>`;
      card.addEventListener('click', () => toggleSelect(i, card));
      grid.appendChild(card);
    });

    function toggleSelect(i, card) {
      const idx = selected.indexOf(i);
      if (idx > -1) {
        selected.splice(idx, 1);
        card.classList.remove('selected');
      } else {
        if (selected.length >= 15) {
          alert('Maximum 15 kártyát választhatsz ki.');
          return;
        }
        selected.push(i);
        card.classList.add('selected');
      }
      nextBtn.disabled = selected.length < 10;
    }

    nextBtn.addEventListener('click', () => {
      step1.style.display = 'none';
      step2.style.display = 'block';
      startRanking();
    });

    restartBtn.addEventListener('click', () => location.reload());

    // Merge-sort style ranking
    async function startRanking() {
      const chosen = selected.map(i => values[i]);
      const sorted = await mergeSort(chosen);
      showResult(sorted);
    }
    async function mergeSort(arr) {
      if (arr.length <= 1) return arr;
      const mid = Math.floor(arr.length / 2);
      const left = await mergeSort(arr.slice(0, mid));
      const right = await mergeSort(arr.slice(mid));
      return await merge(left, right);
    }
    async function merge(left, right) {
      const merged = [];
      while (left.length && right.length) {
        const a = left[0], b = right[0];
        const choice = await userCompare(a, b);
        if (choice === 'left') merged.push(left.shift()); else merged.push(right.shift());
      }
      return merged.concat(left, right);
    }
    function userCompare(a, b) {
      return new Promise(resolve => {
        compareArea.innerHTML = '';
        [a, b].forEach((v, idx) => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `<div class="card-title">${v.name}</div><div class="card-def">${v.def}</div>`;
          card.addEventListener('click', () => resolve(idx === 0 ? 'left' : 'right'));
          compareArea.appendChild(card);
        });
      });
    }

    function showResult(sorted) {
      step2.style.display = 'none';
      resultSec.style.display = 'block';
      const top5 = sorted.slice(0, 5);
      resultList.innerHTML = '<ol>' + top5.map(v => `<li>${v.name}</li>`).join('') + '</ol>';
    }

    downloadBtn.addEventListener('click', () => {
      html2canvas(resultList).then(canvas => {
        const link = document.createElement('a');
        link.download = 'top5_valeham.png';
        link.href = canvas.toDataURL();
        link.click();
      });
    });
  </script>
</body>
</html>
